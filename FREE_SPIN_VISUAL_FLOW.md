# ğŸ¡ Free Spin Wheel System - Visual Flow Diagram

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE LAYER                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FreeSpins.jsx  â”‚  â”‚ FreeSpinDetail   â”‚  â”‚ CollectionDetail â”‚  â”‚
â”‚  â”‚  Landing Page   â”‚â†’ â”‚  Campaign Page   â”‚  â”‚  With Spin Wheel â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                     â”‚                      â”‚             â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                  â”‚                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                    â”‚   SpinWheel.jsx          â”‚                     â”‚
â”‚                    â”‚   (Container Component)   â”‚                     â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                  â”‚                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                    â”‚   Wheel3D.jsx            â”‚                     â”‚
â”‚                    â”‚   (3D Wheel Animation)   â”‚                     â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ API Calls
                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SERVICE LAYER                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                  â”‚  freeSpinService.js       â”‚                       â”‚
â”‚                  â”‚  â€¢ getActiveCampaigns()   â”‚                       â”‚
â”‚                  â”‚  â€¢ getCampaignById()      â”‚                       â”‚
â”‚                  â”‚  â€¢ checkSpinEligibility() â”‚                       â”‚
â”‚                  â”‚  â€¢ executeSpin()          â”‚                       â”‚
â”‚                  â”‚  â€¢ claimPrize()           â”‚                       â”‚
â”‚                  â”‚  â€¢ getSpinHistory()       â”‚                       â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                              â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ Database Queries
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATABASE LAYER (Supabase)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Tables                                          â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â€¢ free_spin_campaigns   - Campaign configs                 â”‚   â”‚
â”‚  â”‚  â€¢ free_spin_whitelist   - Access control                   â”‚   â”‚
â”‚  â”‚  â€¢ free_spin_history     - Spin records                     â”‚   â”‚
â”‚  â”‚  â€¢ free_spin_prize_inv   - NFT inventory                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Functions                                       â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â€¢ check_and_use_spin()  - Atomic spin validation          â”‚   â”‚
â”‚  â”‚  â€¢ reserve_prize()       - Atomic prize reservation         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## User Flow: Spinning the Wheel

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  User arrives    â”‚
                        â”‚  at collection   â”‚
                        â”‚  or free spins   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  Connect wallet  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Check eligibility      â”‚
                   â”‚  â€¢ Whitelist status     â”‚
                   â”‚  â€¢ Spins remaining      â”‚
                   â”‚  â€¢ Campaign active      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                     â”‚
                   â–¼                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Not eligible  â”‚    â”‚   Eligible   â”‚
          â”‚  Show reason   â”‚    â”‚  Show wheel  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  User clicks    â”‚
                              â”‚  "SPIN" button  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  Server validates       â”‚
                         â”‚  and selects prize      â”‚
                         â”‚  (Server-side RNG)      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  3D wheel animates      â”‚
                         â”‚  (4-5 second spin)      â”‚
                         â”‚  Lands on target        â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  Prize modal displays   â”‚
                         â”‚  Show what was won      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                     â”‚
                         â–¼                     â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  NFT Prize      â”‚   â”‚   Message     â”‚
                â”‚  Show claim btn â”‚   â”‚   Try again   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  User clicks claim  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  NFT transferred        â”‚
                â”‚  Transaction hash shown â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Admin Flow: Creating a Campaign

```
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  Admin connects      â”‚
                     â”‚  wallet              â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  Navigate to         â”‚
                     â”‚  /admin/spin-campaignsâ”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  Click "Create       â”‚
                     â”‚  Campaign"           â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Fill campaign details:       â”‚
                â”‚  â€¢ Select collection          â”‚
                â”‚  â€¢ Enter name & description   â”‚
                â”‚  â€¢ Set dates (optional)       â”‚
                â”‚  â€¢ Configure spins per wallet â”‚
                â”‚  â€¢ Enable/disable whitelist   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Add prizes:                  â”‚
                â”‚  â€¢ Prize label                â”‚
                â”‚  â€¢ Probability (0-1)          â”‚
                â”‚  â€¢ Color                      â”‚
                â”‚  â€¢ Repeat for each prize      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Verify probabilities = 1.0   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  Submit campaign     â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                â”‚
                â–¼                                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Whitelist required? â”‚      â”‚  Public campaign    â”‚
    â”‚  Add addresses       â”‚      â”‚  Ready to use!      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow: Spin Execution

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SPIN EXECUTION FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. User clicks "SPIN"
   â”‚
   â–¼
2. Frontend â†’ freeSpinService.executeSpin(campaignId, wallet)
   â”‚
   â–¼
3. Database â†’ check_and_use_spin(campaignId, wallet)
   â”‚
   â”œâ”€â†’ Load campaign (FOR UPDATE lock)
   â”œâ”€â†’ Validate active status
   â”œâ”€â†’ Validate date range
   â”œâ”€â†’ Check whitelist (if required)
   â”œâ”€â†’ Check spin count
   â”œâ”€â†’ Decrement available spins (atomic)
   â”‚
   â–¼
4. Select prize (server-side)
   â”‚
   â”œâ”€â†’ Get campaign prizes
   â”œâ”€â†’ Generate random number
   â”œâ”€â†’ Select based on probability
   â”‚
   â–¼
5. Handle prize based on type
   â”‚
   â”œâ”€â†’ IF NFT:
   â”‚   â”œâ”€â†’ reserve_prize(campaignId, wallet, nftId)
   â”‚   â”œâ”€â†’ Lock inventory item (SKIP LOCKED)
   â”‚   â”œâ”€â†’ Mark as reserved
   â”‚   â””â”€â†’ Return NFT details
   â”‚
   â””â”€â†’ IF Message:
       â””â”€â†’ Return message text
   â”‚
   â–¼
6. Record in history
   â”‚
   â”œâ”€â†’ Insert into free_spin_history
   â”œâ”€â†’ Store prize data
   â”œâ”€â†’ Generate verification hash
   â”œâ”€â†’ Set initial status
   â”‚
   â–¼
7. Return result to frontend
   â”‚
   â”œâ”€â†’ Prize details
   â”œâ”€â†’ Target segment index
   â”œâ”€â†’ Spins remaining
   â”œâ”€â†’ History ID
   â”‚
   â–¼
8. Frontend triggers animation
   â”‚
   â”œâ”€â†’ Wheel rotates to target
   â”œâ”€â†’ 4-5 second animation
   â”œâ”€â†’ Lands on correct segment
   â”‚
   â–¼
9. Display prize modal
   â”‚
   â”œâ”€â†’ Show prize details
   â”œâ”€â†’ Show claim button (if NFT)
   â”œâ”€â†’ Update spin count
   â”‚
   â–¼
10. User claims (if NFT)
    â”‚
    â”œâ”€â†’ freeSpinService.claimPrize(historyId, wallet)
    â”œâ”€â†’ Transfer NFT on blockchain
    â”œâ”€â†’ Update inventory status â†’ "claimed"
    â”œâ”€â†’ Update history status â†’ "completed"
    â””â”€â†’ Show transaction hash
```

## Security Flow: Attack Prevention

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SECURITY VALIDATION FLOW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Attack: Double Spinning
â”‚
â”œâ”€â†’ Prevention: Atomic check_and_use_spin() function
â”‚   â”œâ”€â†’ Lock row with FOR UPDATE
â”‚   â”œâ”€â†’ Validate and decrement in single transaction
â”‚   â””â”€â†’ Second attempt sees updated count
â”‚
â”œâ”€â†’ Result: âœ… Second spin rejected

Attack: Prize Manipulation
â”‚
â”œâ”€â†’ Prevention: Server-side RNG
â”‚   â”œâ”€â†’ Client sends no prize data
â”‚   â”œâ”€â†’ Server calculates prize based on probabilities
â”‚   â”œâ”€â†’ Verification hash prevents tampering
â”‚   â””â”€â†’ Client cannot influence outcome
â”‚
â”œâ”€â†’ Result: âœ… Fair and secure

Attack: Inventory Conflicts
â”‚
â”œâ”€â†’ Prevention: SKIP LOCKED on prize reservation
â”‚   â”œâ”€â†’ reserve_prize() uses FOR UPDATE SKIP LOCKED
â”‚   â”œâ”€â†’ First winner locks the row
â”‚   â”œâ”€â†’ Second winner skips and gets next available
â”‚   â””â”€â†’ No duplicate claims possible
â”‚
â”œâ”€â†’ Result: âœ… Each NFT claimed once

Attack: Whitelist Bypass
â”‚
â”œâ”€â†’ Prevention: Database-level enforcement
â”‚   â”œâ”€â†’ check_and_use_spin() validates whitelist
â”‚   â”œâ”€â†’ Unique constraint on campaign + wallet
â”‚   â”œâ”€â†’ Cannot bypass via multiple requests
â”‚   â””â”€â†’ Row Level Security policies
â”‚
â”œâ”€â†’ Result: âœ… Only whitelisted can spin

Attack: Excessive Spins
â”‚
â”œâ”€â†’ Prevention: Atomic decrement with constraints
â”‚   â”œâ”€â†’ CHECK constraint: spins_used <= spins_allowed
â”‚   â”œâ”€â†’ Update fails if constraint violated
â”‚   â”œâ”€â†’ Transaction rolls back
â”‚   â””â”€â†’ Error returned to client
â”‚
â”œâ”€â†’ Result: âœ… Cannot exceed limit

Attack: Network Failures
â”‚
â”œâ”€â†’ Prevention: Idempotent operations
â”‚   â”œâ”€â†’ History records with unique IDs
â”‚   â”œâ”€â†’ Status tracking (pending â†’ completed)
â”‚   â”œâ”€â†’ Retry logic for failed claims
â”‚   â””â”€â†’ Optimistic UI with server confirmation
â”‚
â”œâ”€â†’ Result: âœ… Graceful failure handling
```

## Component Hierarchy

```
App.jsx
â”‚
â”œâ”€ Header.jsx
â”‚
â”œâ”€ Routes
â”‚   â”‚
â”‚   â”œâ”€ /free-spins
â”‚   â”‚   â””â”€ FreeSpins.jsx
â”‚   â”‚       â”œâ”€ Campaign Cards (grid)
â”‚   â”‚       â””â”€ Filter Controls
â”‚   â”‚
â”‚   â”œâ”€ /free-spins/:campaignId
â”‚   â”‚   â””â”€ FreeSpinDetail.jsx
â”‚   â”‚       â”œâ”€ Campaign Header
â”‚   â”‚       â”œâ”€ SpinWheel (embedded=false)
â”‚   â”‚       â”‚   â”œâ”€ Wheel3D
â”‚   â”‚       â”‚   â”œâ”€ Spin Button
â”‚   â”‚       â”‚   â”œâ”€ Prize Modal
â”‚   â”‚       â”‚   â””â”€ Spin History
â”‚   â”‚       â””â”€ Campaign Sidebar
â”‚   â”‚           â”œâ”€ Details
â”‚   â”‚           â”œâ”€ Stats
â”‚   â”‚           â””â”€ Prize List
â”‚   â”‚
â”‚   â”œâ”€ /collection/:id
â”‚   â”‚   â””â”€ CollectionDetail.jsx
â”‚   â”‚       â”œâ”€ Collection Header
â”‚   â”‚       â”œâ”€ SpinWheel (embedded=true) â† NEW!
â”‚   â”‚       â”‚   â””â”€ (same structure as above)
â”‚   â”‚       â””â”€ NFT Grid
â”‚   â”‚
â”‚   â””â”€ /admin/spin-campaigns
â”‚       â””â”€ AdminSpinCampaign.jsx
â”‚           â”œâ”€ Campaign List
â”‚           â”œâ”€ Create Modal
â”‚           â”‚   â”œâ”€ Form Fields
â”‚           â”‚   â””â”€ Prize Editor
â”‚           â””â”€ Whitelist Modal
```

## State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SpinWheel Component State                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Initial State:                                                â”‚
â”‚  â”œâ”€ campaign: null                                             â”‚
â”‚  â”œâ”€ loading: true                                              â”‚
â”‚  â”œâ”€ spinning: false                                            â”‚
â”‚  â”œâ”€ canSpin: false                                             â”‚
â”‚  â”œâ”€ spinsRemaining: 0                                          â”‚
â”‚  â”œâ”€ targetSegment: null                                        â”‚
â”‚  â””â”€ prizeResult: null                                          â”‚
â”‚                                                                â”‚
â”‚  On Mount:                                                     â”‚
â”‚  â”œâ”€ loadCampaign() â†’ Set campaign                             â”‚
â”‚  â”œâ”€ checkEligibility() â†’ Set canSpin, spinsRemaining          â”‚
â”‚  â””â”€ loadSpinHistory() â†’ Set history                           â”‚
â”‚                                                                â”‚
â”‚  On Spin Click:                                                â”‚
â”‚  â”œâ”€ Set spinning: true                                         â”‚
â”‚  â”œâ”€ executeSpin() â†’ Get prizeResult, targetSegment            â”‚
â”‚  â”œâ”€ Trigger Wheel3D animation                                 â”‚
â”‚  â””â”€ Wait for animation complete                               â”‚
â”‚                                                                â”‚
â”‚  On Spin Complete:                                             â”‚
â”‚  â”œâ”€ Set spinning: false                                        â”‚
â”‚  â”œâ”€ Show prize modal                                           â”‚
â”‚  â”œâ”€ Update spinsRemaining                                      â”‚
â”‚  â””â”€ Refresh history                                            â”‚
â”‚                                                                â”‚
â”‚  On Claim:                                                     â”‚
â”‚  â”œâ”€ Set claimingPrize: true                                    â”‚
â”‚  â”œâ”€ claimPrize() â†’ Get txHash                                 â”‚
â”‚  â”œâ”€ Update prizeResult.claimed                                 â”‚
â”‚  â”œâ”€ Show success message                                       â”‚
â”‚  â””â”€ Set claimingPrize: false                                   â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ERROR HANDLING FLOW                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Error Occurs
â”‚
â”œâ”€â†’ Service Layer (freeSpinService.js)
â”‚   â”œâ”€â†’ Catch error
â”‚   â”œâ”€â†’ Log to console
â”‚   â”œâ”€â†’ Transform to AppError
â”‚   â””â”€â†’ Throw to component
â”‚
â”œâ”€â†’ Component Layer (SpinWheel.jsx)
â”‚   â”œâ”€â†’ Catch in try/catch
â”‚   â”œâ”€â†’ Display toast notification
â”‚   â”œâ”€â†’ Reset spinning state
â”‚   â”œâ”€â†’ Clear loading indicators
â”‚   â””â”€â†’ Show error state to user
â”‚
â””â”€â†’ Database Layer (Postgres)
    â”œâ”€â†’ Constraint violation
    â”œâ”€â†’ Transaction rollback
    â”œâ”€â†’ Return error to service
    â””â”€â†’ Preserve data integrity

Common Errors:
â”‚
â”œâ”€ "Campaign not found"
â”‚  â””â”€â†’ Invalid campaign ID or deleted
â”‚
â”œâ”€ "Wallet not whitelisted"
â”‚  â””â”€â†’ Add wallet to whitelist
â”‚
â”œâ”€ "No spins remaining"
â”‚  â””â”€â†’ User exceeded limit
â”‚
â”œâ”€ "Campaign has ended"
â”‚  â””â”€â†’ Past end date
â”‚
â”œâ”€ "No prizes available"
â”‚  â””â”€â†’ Empty inventory
â”‚
â””â”€ "Transaction failed"
   â””â”€â†’ Blockchain error, retry
```

## Performance Optimization Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OPTIMIZATION STRATEGIES                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Database Level:                                               â”‚
â”‚  â”œâ”€ Indexes on frequently queried columns                     â”‚
â”‚  â”œâ”€ Composite indexes for joins                               â”‚
â”‚  â”œâ”€ FOR UPDATE locks only when needed                         â”‚
â”‚  â”œâ”€ SKIP LOCKED for concurrent access                         â”‚
â”‚  â””â”€ Materialized stats (cached counts)                        â”‚
â”‚                                                                â”‚
â”‚  Service Level:                                                â”‚
â”‚  â”œâ”€ Batched eligibility checks                                â”‚
â”‚  â”œâ”€ Cached campaign data                                      â”‚
â”‚  â”œâ”€ Debounced API calls                                       â”‚
â”‚  â”œâ”€ Promise.all for parallel queries                          â”‚
â”‚  â””â”€ Retry logic with exponential backoff                      â”‚
â”‚                                                                â”‚
â”‚  Frontend Level:                                               â”‚
â”‚  â”œâ”€ React.memo for expensive renders                          â”‚
â”‚  â”œâ”€ useMemo for computed values                               â”‚
â”‚  â”œâ”€ useCallback for event handlers                            â”‚
â”‚  â”œâ”€ Lazy loading for heavy components                         â”‚
â”‚  â”œâ”€ Optimistic UI updates                                     â”‚
â”‚  â”œâ”€ RequestAnimationFrame for animations                      â”‚
â”‚  â””â”€ Image lazy loading                                        â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

This visual diagram should help understand how all the pieces fit together! ğŸ¡

